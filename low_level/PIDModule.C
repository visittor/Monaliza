/*
*************************** C SOURCE FILE ************************************

project   :
filename  : CTEMPLATE.C
version   : 2
date      :

******************************************************************************

Copyright (c) 20xx
All rights reserved.

******************************************************************************

VERSION HISTORY:
----------------------------
Version      : 1
Date         :
Revised by   :
Description  :

Version      : 2
Date         :
Revised by   :
Description  : *
               *
               *

******************************************************************************
*/

#define PIDModule_C_SRC

/****************************************************************************/
/**                                                                        **/
/**                             MODULES USED                               **/
/**                                                                        **/
/****************************************************************************/

#include "PIDModule.H"

/****************************************************************************/
/**                                                                        **/
/**                        DEFINITIONS AND MACROS                          **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                        TYPEDEFS AND STRUCTURES                         **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                      PROTOTYPES OF LOCAL FUNCTIONS                     **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                           EXPORTED VARIABLES                           **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                            GLOBAL VARIABLES                            **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/
/**                                                                        **/
/**                           EXPORTED FUNCTIONS                           **/
/**                                                                        **/
/****************************************************************************/
void InitialPID(PIDParameter *MOTOR)
{
	
	MOTOR->previousError = 0;
	MOTOR->errorSummation = 0;
	MOTOR->u = 0;

	// Paremeter for velocity form
	
	MOTOR->delta_u = 0;
	MOTOR->PreviousU1 = 0;
	MOTOR->PreviousE1 = 0;
	MOTOR->PreviousE2 = 0;
}


void PIDPositionalForm(float error, PIDParameter *MOTOR)
{
	MOTOR->errorSummation += error;
	MOTOR->previousError = error;

	MOTOR->u = (MOTOR->Kp * error) + (MOTOR->Ki * MOTOR->errorSummation) + (MOTOR->Kd*(error - MOTOR->previousError));
}

void PIDVelocityForm(float error , PIDParameter *MOTOR)
{

	MOTOR->delta_u = ((MOTOR->Kp + MOTOR->Ki + MOTOR->Kd)*error)-((MOTOR->Kp+2*MOTOR->Kd)*MOTOR->PreviousE1) + MOTOR->Kd*MOTOR->PreviousE2;
	MOTOR->u = MOTOR->PreviousU1 + MOTOR->delta_u;
	// if(MOTOR->u > 750)
	// {
	// 	MOTOR->u = 750;
	// }
	MOTOR->PreviousU1 = MOTOR->u;
	MOTOR->PreviousE2 = MOTOR->PreviousE1;
	MOTOR->PreviousE1 = error;

}
/****************************************************************************/
/**                                                                        **/
/**                             LOCAL FUNCTIONS                            **/
/**                                                                        **/
/****************************************************************************/


/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                                 EOF                                    **/
/**                                                                        **/
/****************************************************************************/